# Code Conformance Exemptions
#
# This file tracks exemptions from code conformance rules. Exemptions are granted
# for existing code that violates rules but cannot be fixed immediately.
#
# All exemptions should:
# - Include a clear reason explaining why the exemption is needed
# - Reference a ticket number for tracking future removal (when applicable)
# - Be reviewed periodically to assess if they can be removed
#
# Format:
#   exemptions:
#     - rule: <rule-id>
#       files:
#         - <file-path-or-glob>
#       reason: <explanation>
#       ticket: <ticket-number>  # optional

exemptions:
  # ===========================================================================
  # asyncio.sleep() exemptions - Helper implementation
  # ===========================================================================
  - rule: no-asyncio-sleep-in-tests
    files:
      - tests/helpers.py
    reason: |
      The wait_for_condition() helper itself needs asyncio.sleep() for its polling
      implementation. The rule's spirit (avoid fixed waits in tests) doesn't apply
      to the implementation of the proper alternative.
    ticket: null

  # ===========================================================================
  # asyncio.sleep() exemptions - Mock implementations
  # ===========================================================================
  - rule: no-asyncio-sleep-in-tests
    files:
      - tests/mocks/mock_llm.py
      - tests/integration/llm/streaming_mocks.py
    reason: |
      Mock implementations intentionally simulate realistic delays and streaming
      behavior. The rule targets flaky test waits, not deliberate timing simulation.
    ticket: null

  # ===========================================================================
  # asyncio.sleep() exemptions - Legacy test code (to be refactored)
  # ===========================================================================
  - rule: no-asyncio-sleep-in-tests
    files:
      - tests/conftest.py
      - tests/functional/indexing/*.py
      - tests/functional/test_*.py
      - tests/functional/web/test_*.py
      - tests/functional/web/conftest.py
      - tests/unit/web/test_message_notifier.py
    reason: |
      Legacy tests that predate wait_for_condition() helper.
      Should be refactored to use condition-based waiting.
    ticket: "#TBD-refactor-sleep-to-wait-for-condition"

  # ===========================================================================
  # time.sleep() exemptions - Legacy test code (to be refactored)
  # ===========================================================================
  - rule: no-time-sleep-in-tests
    files:
      - tests/conftest.py
    reason: |
      Legacy test fixtures in conftest.py use time.sleep() for synchronous
      blocking waits. Should be refactored to use async alternatives.
    ticket: "#TBD-refactor-sleep-to-wait-for-condition"

