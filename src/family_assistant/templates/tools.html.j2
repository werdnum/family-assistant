{% extends "base.html.j2" %}

{% block title_header %}Available Tools{% endblock %}

{% block head_extra %}
    <style>
    	main {
    		background-color: var(--bg);
    		color: var(--text);
    	}
        /* Styles for json-schema-for-humans flat template */
        .schema-table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
        .schema-table th, .schema-table td { border: 1px solid var(--border); padding: 0.5rem; text-align: left; }
        .schema-table th { background-color: var(--accent-bg); }
        .schema-table code { background-color: var(--bg); padding: 0.1em 0.3em; border-radius: 3px; }

        .tool-card { margin-bottom: 1.5rem; padding: 1rem; border: 1px solid var(--border); border-radius: 5px; background-color: var(--accent-bg); }
        .tool-card h3 { margin-top: 0; }
        .tool-result-container { margin-top: 0.5rem; border: 1px dashed var(--border); padding: 0.5rem; min-height: 50px; background-color: var(--bg); }
        .tool-result-container .error { color: var(--error); font-weight: bold;}
    </style>
{% endblock %}

{% block main_content %}
    {% if tools %}
        <p>The LLM has access to the following {{ tools|length }} tools:</p>
        {% for tool in tools %}
            <article class="tool-card">
                <h3>{{ tool.function.name }}</h3>
                <p>{{ tool.function.description }}</p>
                <strong>Parameters:</strong>
                <details>
                    <summary style="cursor: pointer; font-weight: bold;">Show/Hide Schema</summary>
                    <div style="margin-top: 0.5rem;">{{ tool.parameters_html | safe }}</div>
                </details>
                <details style="margin-top: 1rem;">
                    <summary style="cursor: pointer; font-weight: bold;">Test Tool</summary>
                    <div style="margin-top: 0.5rem;">
                        <form class="tool-test-form" data-tool-name="{{ tool.function.name }}">
                            <label for="args-editor-{{ loop.index }}">Arguments:</label>
                            <div id="args-editor-{{ loop.index }}" class="json-editor-arguments-container" style="margin-bottom: 0.5rem;"></div>
                            <script id="schema-{{ loop.index }}" type="application/json">{{ tool.function.parameters | tojson | safe }}</script>
                            <button type="submit" id="submit-button-{{ loop.index }}">Test Tool</button>
                        </form>
                        <div class="tool-result-container" id="result-{{ loop.index }}"></div>
                    </div>
                </details>
            </article>
        {% endfor %}
    {% else %}
        <p>No tool definitions are currently available.</p>
    {% endif %}
{% endblock %}

{% block scripts_extra %}
<script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>
<script type="module" src="https://unpkg.com/vanilla-jsoneditor/standalone.js"></script>
<script type="module" src="{{ request.app.url_path_for('static', path='js/json_editor_tool_tester.js') }}"></script>
{% endblock %}
