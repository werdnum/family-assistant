<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduled Tasks</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 1em; table-layout: fixed; } /* Added table-layout */
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; vertical-align: top; word-wrap: break-word; } /* Added word-wrap */
        th { background-color: #f2f2f2; }
        .nav-links a { margin-right: 1em; }
        .nav-links { margin-bottom: 1em; }
        pre { white-space: pre-wrap; word-wrap: break-word; max-height: 100px; overflow-y: auto; background-color: #f8f8f8; padding: 5px; border: 1px solid #eee;} /* Limit height and add scroll */
        .status-pending { background-color: #e3f2fd; }
        .status-processing { background-color: #fff9c4; }
        .status-done { background-color: #e8f5e9; }
        .status-failed { background-color: #ffebee; }
        .col-id { width: 5%; }
        .col-taskid { width: 15%; }
        .col-type { width: 10%; }
        .col-status { width: 8%; }
        .col-scheduled { width: 12%; }
        .col-created { width: 12%; }
        .col-retries { width: 8%; }
        .col-payload { width: 15%; }
        .col-error { width: 15%; }

    </style>
</head>
<body>
    <h1>Scheduled Tasks</h1>

    <div class="nav-links">
        <a href="/">View Notes</a> |
        <a href="/history">View Message History</a>
    </div>

    {% if tasks %}
    <table>
        <thead>
            <tr>
                <th class="col-id">ID</th>
                <th class="col-taskid">Task ID</th>
                <th class="col-type">Type</th>
                <th class="col-status">Status</th>
                <th class="col-scheduled">Scheduled At</th>
                <th class="col-created">Created At</th>
                <th class="col-retries">Retries (Count/Max)</th>
                <th class="col-payload">Payload</th>
                <th class="col-error">Last Error</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr class="status-{{ task.status }}">
                <td class="col-id">{{ task.id }}</td>
                <td class="col-taskid">{{ task.task_id }}</td>
                <td class="col-type">{{ task.task_type }}</td>
                <td class="col-status">{{ task.status }}</td>
                <td class="col-scheduled">{{ task.scheduled_at.strftime('%Y-%m-%d %H:%M:%S %Z') if task.scheduled_at else 'Immediate' }}</td>
                <td class="col-created">{{ task.created_at.strftime('%Y-%m-%d %H:%M:%S %Z') }}</td>
                <td class="col-retries">{{ task.retry_count }} / {{ task.max_retries }}</td>
                <td class="col-payload"><pre>{{ task.payload | tojson(indent=2) if task.payload else 'None' }}</pre></td>
                <td class="col-error"><pre>{{ task.error if task.error else 'None' }}</pre></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No tasks found.</p>
    {% endif %}

</body>
</html>
