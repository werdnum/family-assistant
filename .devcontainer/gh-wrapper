#!/bin/bash
# Wrapper for gh CLI to inject GitHub App authentication if available

if [ -n "$GITHUB_APP_PRIVATE_KEY_FILE" ] && [ -n "$GITHUB_APP_ID" ] && [ -n "$GITHUB_APP_INSTALLATION_ID" ]; then
    TOKEN=$(gh-token generate --key "$GITHUB_APP_PRIVATE_KEY_FILE" --app-id "$GITHUB_APP_ID" --installation-id "$GITHUB_APP_INSTALLATION_ID" | jq -r .token)
    if [ $? -eq 0 ] && [ -n "$TOKEN" ]; then
        export GH_TOKEN="$TOKEN"
    fi
fi

exec /usr/bin/gh "$@"
